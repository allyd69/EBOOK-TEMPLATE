<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROBOOK AI: Ebook Creator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <style>
        /* --- General Styling --- */
        body {
            font-family: 'Georgia', serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #333;
        }

        /* --- Main Title Bar (Top of Image 2) --- */
        .app-header {
            width: 800px; /* Match form/preview width */
            background-color: #34495e;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        .app-header h1 {
            margin: 0;
            font-size: 2em;
            font-family: sans-serif; /* More modern font for app title */
            letter-spacing: 1px;
        }
        .app-header p {
            margin: 5px 0 0;
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* --- Input Form Styling (Mimicking Image 2) --- */
        #inputForm {
            background-color: #ffffff;
            border-radius: 0 0 8px 8px; /* Rounded bottom corners */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 30px;
            width: 800px;
            max-width: 90%;
            margin-bottom: 20px;
        }
        #inputForm h2 {
            font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, serif;
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        .form-group select,
        .form-group textarea {
            width: calc(100% - 20px); /* Adjust for padding */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            font-family: 'Georgia', serif;
        }
        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        .checkbox-group input {
            margin-right: 10px;
        }

        .form-actions {
            text-align: center;
            margin-top: 30px;
        }
        .form-actions button {
            padding: 12px 25px;
            background-color: #007bff; /* Blue for primary action */
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .form-actions button:hover {
            background-color: #0056b3;
        }

        /* --- Navigation Bar (for Preview) --- */
        .navigation {
            background-color: #ffffff;
            border: 1px solid #ddd;
            padding: 10px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: space-between;
            width: 800px;
            max-width: 90%;
        }
        
        .hide-for-print {
            display: none !important;
        }

        .navigation button {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .navigation button.secondary {
            background-color: #6c757d; /* Grey for 'Back to Edit' */
        }
        .navigation button.secondary:hover {
            background-color: #5a6268;
        }


        .navigation button:hover:not(:disabled) {
            background-color: #45a049;
        }

        .navigation button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .page-info {
            font-size: 1.1em;
            color: #333;
        }

        /* --- Preview Container - FIXED HEIGHT FOR PROFESSIONAL LOOK --- */
        #previewContainer {
            position: relative;
            width: 800px;
            height: 1000px; /* FIXED HEIGHT */
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            background-color: #fff;
            padding: 0;
            overflow: hidden; 
            margin-top: 0; /* Align with header */
            border-radius: 0 0 8px 8px;
        }

        /* --- Page Styling --- */
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%; /* Use 100% of container height */
            padding: 50px;
            box-sizing: border-box;
            background-color: #fff;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s;
            overflow-y: hidden; /* Crucial: Prevents scrollbars in preview */
        }

        .page.active {
            opacity: 1;
            visibility: visible;
            position: relative;
            z-index: 10;
        }
        
        /* PDF Generation Styles (pdf-ready class) */
        .page.pdf-ready {
            position: relative; 
            opacity: 1;
            visibility: visible;
            height: auto; 
            min-height: 1000px; 
            overflow-y: hidden;
            page-break-after: always; 
        }
        .page:last-child.pdf-ready {
            page-break-after: avoid; 
        }

        /* Content within a page */
        .content-page {
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
            color: #333;
            min-height: calc(100% - 40px); 
        }

        h1, h2, h3 {
            font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, serif;
            color: #2c3e50;
        }

        h1 { font-size: 2.5em; text-align: center; margin-top: 100px; }
        h2 { font-size: 1.8em; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-top: 30px; }

        /* Cover Page Specifics */
        .cover-page {
            background: linear-gradient(135deg, #f0f4f7, #e0e8ed);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Page Number */
        .page-number {
            position: absolute;
            bottom: 20px;
            right: 50%;
            transform: translateX(50%);
            font-size: 0.9em;
            color: #7f8c8d;
        }
    </style>
</head>
<body>

    <div class="app-header">
        <h1>Professional Ebook Creator</h1>
        <p>DESIGN & DEPLOY BEAUTIFUL EBOOKS</p>
    </div>

    <div id="inputFormSection">
        <div id="inputForm">
            <h2>Book Details</h2>
            <div class="form-group">
                <label for="bookCategory">BOOK CATEGORY</label>
                <select id="bookCategory">
                    <option value="">Select a category</option>
                    <option value="fiction">Fiction</option>
                    <option value="non-fiction">Non-Fiction</option>
                    <option value="science">Science & Technology</option>
                    <option value="history">History</option>
                    <option value="biography">Biography</option>
                    <option value="poetry">Poetry</option>
                    <option value="cookbooks">Cookbooks</option>
                    <option value="children">Children's Books</option>
                </select>
            </div>
            <div class="form-group">
                <label for="introductionText">INTRODUCTION TEXT (EDIT AS NEEDED)</label>
                <textarea id="introductionText" placeholder="Start typing your introduction here..."></textarea>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="romanNumerals" checked>
                <label for="romanNumerals">Use Roman numerals for front matter</label>
            </div>
            <div class="form-actions">
                <button onclick="generatePreview()">Generate Preview</button>
            </div>
        </div>
    </div>

    <div id="previewSection" style="display: none;">
        <div class="navigation" id="mainNavigation">
            <button class="secondary" onclick="showInputForm()">← Back to Edit</button>
            <button id="prevBtn" onclick="previousPage()">← Previous</button>
            <div class="page-info">
                Page <span id="currentPage">1</span> of <span id="totalPages">8</span>
            </div>
            <button id="nextBtn" onclick="nextPage()">Next →</button>
            <button onclick="addNewPage()" style="background-color: #3498db;">+ Add Custom Page</button>
            <button id="downloadBtn" onclick="downloadPDF()" style="background-color: #e74c3c;">Download PDF</button>
        </div>

        <div id="previewContainer">
            <div class="page cover-page active" data-page="0">
                <h1>The PROBOOK AI Guide</h1>
                <div class="subtitle">Publish-Ready Ebooks in One Click</div>
                <div class="author">By A. N. Author</div>
            </div>

            <div class="page" data-page="1">
                <div class="content-page">
                    <h2>Table of Contents</h2>
                    <ol>
                        <li>Introduction . . . . . . . . . . . . . . . . . . . . . . . . . 3</li>
                        <li>Getting Started . . . . . . . . . . . . . . . . . . . . . . . . 4</li>
                        <li>Template Deep Dive . . . . . . . . . . . . . . . . . . . . . 5</li>
                        <li>Conclusion . . . . . . . . . . . . . . . . . . . . . . . . . . 6</li>
                        <li>Appendix . . . . . . . . . . . . . . . . . . . . . . . . . . . 7</li>
                        <li>Resources . . . . . . . . . . . . . . . . . . . . . . . . . . 8</li>
                    </ol>
                </div>
                <div class="page-number">i</div> </div>

            <div class="page" data-page="2">
                <div class="content-page">
                    <h2>Introduction</h2>
                    <p id="dynamicIntroduction">Welcome to the era of instant publishing! PROBOOK AI leverages semantic analysis and category bias to intelligently place images and structure your draft. This is where your raw manuscript takes its first breath as a beautiful, print-ready ebook.</p>
                    <p>No more tedious formatting. Just upload your .docx or .txt file, select a template (like this Ethereal one), and watch the magic happen. The system handles all the required front and back matter automatically.</p>
                </div>
                <div class="page-number">3</div>
            </div>

            <div class="page" data-page="3">
                <div class="content-page">
                    <h2>Getting Started</h2>
                    <p>Getting your book ready is a simple 5-step process:</p>
                    <ol>
                        <li>**Upload:** Your manuscript (.docx or .txt)</li>
                        <li>**Customize:** Add images (optional) and set the book category.</li>
                        <li>**Template:** Choose one of the 7 premium templates.</li>
                        <li>**Preview:** Click 'Update Preview' to see the result.</li>
                        <li>**Export:** Hit 'Export to PDF' for a print-ready file.</li>
                    </ol>
                    <p>The AI handles everything from optimal line spacing to intelligent hyphenation, ensuring a professional look that rivals traditionally published books.</p>
                </div>
                <div class="page-number">4</div>
            </div>

            <div class="page" data-page="4">
                <div class="content-page">
                    <h2>Template Deep Dive</h2>
                    <p>The **Ethereal** template you see here is designed for light, airy non-fiction and poetry. It uses a soft color palette and classic serif fonts for a sophisticated feel.</p>
                    <p>Other templates include **Organic** (for cookbooks and nature guides), **Architectural** (for technical manuals), and **Pro** (a clean, modern look for business books). Each template applies specific rules for image size, caption placement, and header/footer design.</p>
                </div>
                <div class="page-number">5</div>
            </div>

            <div class="page" data-page="5">
                <div class="content-page">
                    <h2>Conclusion</h2>
                    <p>You have taken the final step in turning your draft into a polished product. PROBOOK AI is designed to save you countless hours of manual formatting, allowing you to focus on what you do best: **writing**.</p>
                    <p>With features like **TF-IDF Smart Image Placement** and **Auto Front/Back Matter**, you're equipped to publish professional-quality work instantly. We hope you enjoy the simplicity and power of automated design.</p>
                    <h3>What's Next?</h3>
                    <p>Review the final PDF and hit the market! We encourage you to explore the other features, including the built-in marketing tools for social media banners and email templates.</p>
                    <div class="page-number">6</div>
                </div> </div> <div class="page" data-page="6">
                <div class="content-page">
                    <h2>Appendix: PROBOOK AI Tech Stack</h2>
                    <p>The magic behind the system is built with:</p>
                    <ul>
                        <li>**HTML + CSS + JS** (Single File Output)</li>
                        <li>**Mammoth.js:** Used to convert .docx to HTML.</li>
                        <li>**Html2pdf.js + PUG:** For robust PDF export.</li>
                        <li>**TF-IDF:** Smart image placement and semantic analysis.</li>
                    </ul>
                    <p>This allows for a lightweight,

        .input-group input,
        .input-group select,
        .input-group textarea {
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            font-family: 'Montserrat', sans-serif;
            transition: all 0.3s ease;
            background: white;
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(139, 71, 137, 0.1);
        }

        .input-group textarea {
            resize: vertical;
            min-height: 100px;
            font-size: 14px;
        }

        .template-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .template-card {
            padding: 20px;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: white;
        }

        .template-card:hover {
            border-color: var(--color-primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(139, 71, 137, 0.2);
        }

        .template-card.active {
            border-color: var(--color-primary);
            background: linear-gradient(135deg, rgba(139, 71, 137, 0.1) 0%, rgba(212, 163, 115, 0.1) 100%);
        }

        .template-card h3 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--color-dark);
        }

        .template-card p {
            font-size: 12px;
            color: #666;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Montserrat', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-highlight) 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(139, 71, 137, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(139, 71, 137, 0.4);
        }

        .btn-secondary {
            background: var(--color-accent);
            color: white;
            box-shadow: 0 4px 20px rgba(47, 93, 98, 0.3);
        }

        .btn-secondary:hover {
            background: #254851;
            transform: translateY(-2px);
        }

        .btn-add {
            background: var(--color-secondary);
            color: white;
            box-shadow: 0 4px 20px rgba(212, 163, 115, 0.3);
        }

        .btn-add:hover {
            background: #c19563;
            transform: translateY(-2px);
        }

        .preview-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .page {
            width: 600px;
            height: 750px;
            background: white;
            box-shadow: 0 15px 60px rgba(0,0,0,0.4);
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            page-break-after: always;
        }

        /* TEMPLATE STYLES - as before */

        .upload-zone {
            border: 2px dashed #e0e0e0;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            margin-top: 10px;
            border-radius: 8px;
        }

        .upload-zone:hover {
            border-color: var(--color-primary);
        }

        #marketingSection {
            display: none;
            margin-top: 40px;
            background: rgba(255,255,255,0.95);
            padding: 40px;
            border-radius: 16px;
        }
    </style>
    <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
    <script src="https://unpkg.com/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>
    <div class="app-container">
        <div class="app-header">
            <h1>Professional Ebook Creator</h1>
            <p>Design & Deploy Beautiful Ebooks</p>
        </div>

        <div class="control-panel">
            <!-- Template selector as before -->

            <div class="input-group" style="margin-top: 20px;">
                <label>Book Category</label>
                <select id="category">
                    <option value="">Select a category</option>
                    <option value="business">Business / Entrepreneurship</option>
                    <option value="self-help">Self-help / Personal growth</option>
                    <option value="memoir">Memoir / Narrative nonfiction</option>
                    <option value="tech">Tech / How-to</option>
                    <option value="cookbooks">Cookbooks / Lifestyle</option>
                    <option value="design">Design / Artbooks</option>
                    <option value="children">Children’s / Short reads</option>
                </select>
            </div>

            <div class="control-grid">
                <!-- Title, subtitle, author, copyright, ISBN as before -->
            </div>

            <div class="input-group" style="margin-top: 20px;">
                <label>Introduction Text (Edit as needed)</label>
                <textarea id="introText">...</textarea>
            </div>

            <!-- Dedication, Foreword, How to Use, About Author as before -->

            <!-- Text and Images uploads with drop zones as before -->

            <label style="margin-top: 20px;"><input type="checkbox" id="useRoman" checked> Use Roman numerals for front matter</label>

            <div class="button-group" style="margin-top: 30px;">
                <!-- Buttons as before -->
            </div>
        </div>

        <div class="preview-container" id="previewContainer"></div>

        <div id="marketingSection" style="display:none;">
            <h2>Create Your Marketing Materials</h2>
            <p>Generate high-value assets for social media, emails, and more.</p>
            <button class="btn btn-primary" onclick="generateSocialTile()">Generate Social Tile</button>
            <button class="btn btn-primary" onclick="generateEmailSequence()">Generate Pre-Launch Emails</button>
        </div>
    </div>

    <script>
        // Full JS as in previous, with refined image placement, category bias in minSimilarity, fallback logic, and keyword extraction using nouns focus (filter words if possible)
        // For example, in extractKeywords, add: words = words.filter(w => isNoun(w)); // Placeholder for POS, or simple heuristic
        // Update matchImagesToChapters with category bias as per your refinements
        // Ensure fallback: if no match, place every N pages
        let N = 5; // Every 5 pages for fallback
        // In placements fallback: for (let i = 0; i < remaining.length; i++) {
        //     let ch = Math.floor(i * chapters.length / remaining.length);
        //     placements.push({chapter: ch, image: remaining[i]});
        // }
        // Rest as before
    </script>
</body>
</html>
